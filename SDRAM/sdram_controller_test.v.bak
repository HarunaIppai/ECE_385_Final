
//=======================================================
//  This code is generated by Terasic System Builder
//=======================================================

module sdram_controller_test(

	//////////// CLOCK //////////
	input 		          		ADC_CLK_10,
	input 		          		MAX10_CLK1_50,
	input 		          		MAX10_CLK2_50,

	//////////// SDRAM //////////
	output		    [12:0]		DRAM_ADDR,
	output		     [1:0]		DRAM_BA,
	output		          		DRAM_CAS_N,
	output		          		DRAM_CKE,
	output		          		DRAM_CLK,
	output		          		DRAM_CS_N,
	inout 		    [15:0]		DRAM_DQ,
	output		          		DRAM_LDQM,
	output		          		DRAM_RAS_N,
	output		          		DRAM_UDQM,
	output		          		DRAM_WE_N,

	input 							read_command,
	output							read_finished,
	output							data,
	input								address, //in bank-row-column, not sure why there is an extra 0 between row and column
);



//=======================================================
//  REG/WIRE declarations
//=======================================================
//reg   [127:0]   data; just take the first 16 bit
reg     [4:0]   state           = 5'b00001;
reg     [4:0]   next_state      = 5'b00010;

//wire   [24:0]   address         = {22'b00_0000010100001_0110100, SW[2:0]}; //not really sure what happened
wire            reset           = 1'b0;

wire  [127:0]   read_data;

reg             read_request;


always @(posedge MAX10_CLK1_50)
begin
    state <= #1 next_state;
end


always @(state or read_command or read_finished)
begin
    case(state)
        5'b00001:
            if(read_command)
                next_state  <= 5'b01000;
            else
                next_state  <= 5'b00001;
            
        5'b01000:
            if(read_finished)
                next_state  <= 5'b10000;
            else
                next_state  <= 5'b01000;
        5'b10000:
            next_state      <= 5'b00001;
    endcase
end

always @(state)
begin
    case(state)
        5'b00001:
        begin
            read_request    <= #1 1'b0;
        end
        
        5'b01000:
        begin
            read_request    <= #1 1'b1;
        end
        5'b10000:
        begin
            read_request    <= #1 1'b0;
            data            <= #1 read_data[15:0];
        end
    endcase
end

sdram_controller sdram_controller(
	.iclk(MAX10_CLK1_50),
    .ireset(reset),
    
    .iwrite_req(0),
    .iwrite_address(),
    .iwrite_data(),
    .owrite_ack(),
    
    .iread_req(read_request),
    .iread_address(address),
    .oread_data(read_data),
    .oread_ack(read_finished),
    
	//////////// SDRAM //////////
	.DRAM_ADDR(DRAM_ADDR),
    .DRAM_BA(DRAM_BA),
    .DRAM_CAS_N(DRAM_CAS_N),
    .DRAM_CKE(DRAM_CKE),
    .DRAM_CLK(DRAM_CLK),
    .DRAM_CS_N(DRAM_CS_N),
    .DRAM_DQ(DRAM_DQ),
    .DRAM_LDQM(DRAM_LDQM),
    .DRAM_RAS_N(DRAM_RAS_N),
    .DRAM_UDQM(DRAM_UDQM),
    .DRAM_WE_N(DRAM_WE_N)
);

endmodule
